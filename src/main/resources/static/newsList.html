<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="./main.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <title>ë‰´ìŠ¤</title>

    <style>
        tr {
            border: 1px solid #444444;
        }

        th {
            border: 1px solid #444444;
        }

        td {
            border: 1px solid #444444;
        }

    </style>
    <script>
        $(document).ready(function () {
            let selectedNews = []; // ì„ íƒëœ ë‰´ìŠ¤ IDë¥¼ ì €ì¥í•˜ëŠ” ë°°ì—´
            // 1. ë‰´ìŠ¤ ì „ì²´ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ
            $.ajax({
                type: "GET",
                contentType: "application/json; charset=utf-8",
                url: "http://localhost:8080/api/news/all",
                data: JSON.stringify,
                dataType: 'json',
                success: function (response) {
                    let list = response.data;
                    let htmlArr = [];
                    for (let i = 0, length = list.length; i < length; i++) {
                        let item = list[i];
                        let cnt = i + 1;

                        htmlArr.push('<tr>');
                        htmlArr.push('<td>');
                        htmlArr.push('<label class="newsNumber" data-id="' + item.id + '">' + cnt + '</label><br>');
                        htmlArr.push('</td>');

                        // htmlArr.push('<td>');
                        // htmlArr.push('<button class="choiceNews" id="choiceNews' + item.id + '" value="' + item.id + '">' +
                        //     '<label class="news" data-id="' + item.id + '">' + item.choiceNews + '</label></button><br>');
                        // htmlArr.push('</td>');

                        htmlArr.push('<td>');
                        if (item.choiceNews) {
                            htmlArr.push('<button class="choiceNews" id="choiceNews' + item.id + '" value="' + item.id + '" style="background-color:black;color:blue;">' +
                                '<label class="news" data-id="' + item.id + '">' + item.choiceNews + '</label></button><br>');
                        }
                        // else {
                        //     htmlArr.push('<button class="choiceNews" id="choiceNews' + item.id + '" value="' + item.id + '" style="background-color:black;color:blue;">' +
                        //         '<label class="news" data-id="' + item.id + '">' + item.choiceNews + '</label></button><br>');
                        // }
                        htmlArr.push('</td>');

                        htmlArr.push('<td>');
                        htmlArr.push('<label class="news" data-id="' + item.id + '">' + item.message + '</label><br>');
                        htmlArr.push('</td>');

                        htmlArr.push('<td>');
                        htmlArr.push('<label class="news" data-id="' + item.id + '">' + item.author + '</label>');
                        htmlArr.push('</td>');

                        htmlArr.push('<td>');
                        htmlArr.push('<button type="button" class="newsUpdate" id="newsUpdate' + item.id + '" value="' + item.id + '">ìˆ˜ì •<br>');
                        htmlArr.push('</td>');

                        htmlArr.push('<td>');
                        htmlArr.push('<button type="button" class="newsDelete" id="newsDelete' + item.id + '" value="' + item.id + '">ì‚­ì œ<br>');
                        htmlArr.push('</td>');

                        htmlArr.push('</tr>');
                    }

                    $('#tbodyNews').html(htmlArr.join(''));
                    console.log(response);

                },
                error: function (e) {
                    alert("Error: " + e.responseText);
                }
            });
        });

        // ì„ íƒí•˜ë©´ ë…¸ì¶œë  ë‰´ìŠ¤ë¡œ ì§€ì •
        $(document).on('click', '.choiceNews', function () {
            let newsId = $(this).val();
            if (!newsId) {
                alert("ID is undefined.");
                return;
            }

            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "http://localhost:8080/api/news/choice/" + newsId,
                dataType: 'json',
                success: function (response) {
                    if (response.success === true) {
                        location.reload();
                        console.log(response);

                    }
                },
                error: function (e) {
                    alert("Error: " + e.responseText);
                }
            });
        });


        // ë‰´ìŠ¤ ìˆ˜ì •
        $(document).ready(function () {
            // newsUpdate ë²„íŠ¼ í´ë¦­ ì‹œ íŒì—…ì°½ ë„ìš°ê¸°
            $(document).on('click', '.newsUpdate', function () {
                let newsId = $(this).val();
                if (!newsId) {
                    alert("ID is undefined.");
                    return;
                }
                // ë‰´ìŠ¤ ì •ë³´ë¥¼ ê°€ì ¸ì™€ì„œ íŒì—…ì°½ì— ë…¸ì¶œ
                $.ajax({
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    url: "http://localhost:8080/api/news/" + newsId,
                    dataType: 'json',
                    success: function (response) {
                        if (response.success === true) {
                            console.log(response);
                            let news = response.data;
                            // íŒì—…ì°½ì— ë‰´ìŠ¤ ì •ë³´ ì±„ìš°ê¸°
                            $("#popupMessage").val(news.message);
                            $("#popupAuthor").val(news.author);
                            // ë‰´ìŠ¤ ìˆ˜ì • ë²„íŠ¼ì— newsId ì €ì¥
                            $("#popupNewsId").val(newsId);
                            // íŒì—…ì°½ ì—´ê¸°
                            $("#newsUpdateModal").modal("show");
                        }
                    },
                    error: function (e) {
                        alert("Error: " + e.responseText);
                    }
                });
            });

            // ë‰´ìŠ¤ ìˆ˜ì •
            $("#popupUpdateButton").on('click', function () {
                let newsId = $("#popupNewsId").val();
                if (!newsId) {
                    alert("ID is undefined.");
                    return;
                }
                let data = {
                    message: $("#popupMessage").val(),
                    author: $("#popupAuthor").val(),
                };
                $.ajax({
                    type: "PUT",
                    contentType: "application/json; charset=utf-8",
                    url: "http://localhost:8080/api/news/update/" + newsId,
                    data: JSON.stringify(data),
                    dataType: 'json',
                    success: function (response) {
                        if (response.success === true) {
                            console.log(response);
                            alert('ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                            // íŒì—…ì°½ ë‹«ê¸°
                            $("#newsUpdateModal").modal("hide");
                            // í™”ë©´ ìƒˆë¡œê³ ì¹¨
                            location.reload();
                        } else {
                            alert('ì‹¤íŒ¨');
                        }
                    },
                    error: function (e) {
                        alert("Error: " + e.responseText);
                    }
                });
            });
        });

        // ë‰´ìŠ¤ ì‚­ì œ
        $(document).on('click', '.newsDelete', function () {

            let newsId = $(this).val();
            if (!newsId) {
                alert("ID is undefined.");
                return;
            }

            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                $.ajax({
                    type: "DELETE",
                    contentType: "application/json; charset=utf-8",
                    url: "http://localhost:8080/api/news/delete/" + newsId,
                    dataType: 'json',
                    success: function (response) {
                        if (response.success === true) {
                            console.log(response);
                            // alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                            location.reload();
                        } else {
                            alert('ì‚­ì œ ì‹¤íŒ¨');
                        }
                    },
                    error: function (e) {
                        alert("Error: " + e.responseText);
                    }
                });
            }


        });

        // ë‰´ìŠ¤ ê²€ìƒ‰
        $(document).ready(function () {

            $("#searchResultTable").hide();

            $("#searchNewsForm").submit(function (event) {
                event.preventDefault(); // í¼ ì „ì†¡ ë°©ì§€

                let keyword = $("#keywordInput").val(); // ê²€ìƒ‰ì–´ ê°€ì ¸ì˜¤ê¸°
                // var keyword = $("#searchKeyword").val(); // ê²€ìƒ‰ì–´ ê°€ì ¸ì˜¤ê¸°

                $.ajax({
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    url: "http://localhost:8080/api/news/search?keyword=" + keyword,
                    data: JSON.stringify,
                    // data: { keyword: keyword }, // ê²€ìƒ‰ì–´ë¥¼ URL parameterë¡œ ì „ë‹¬
                    dataType: 'json',
                    success: function (response) {
                        if (response.success === true) {
                            // ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì¶œë ¥í•˜ëŠ” ë¶€ë¶„
                            let searchResultTableBody = $("#searchResultTable tbody");
                            searchResultTableBody.empty(); // ê¸°ì¡´ ê²€ìƒ‰ ê²°ê³¼ ì‚­ì œ

                            if (response.data.length > 0) {
                                for (let i = 0; i < response.data.length; i++) {
                                    let news = response.data[i];
                                    let row = $("<tr></tr>");

                                    row.append($("<td></td>").text(i + 1));
                                    row.append($("<td></td>").text(news.message));
                                    row.append($("<td></td>").text(news.author));

                                    searchResultTableBody.append(row);
                                }
                                // ê²€ìƒ‰ê²°ê³¼ë¥¼ ë³´ì´ê¸°
                                $("#searchResultTable").show();
                            } else {
                                alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                            }
                        } else {
                            alert('ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.')
                        }
                    },
                    error: function (e) {
                        alert("Error: " + e.responseText);
                    }
                });
            });
        });


    </script>

</head>
<body>

<form id="searchNewsForm" action="">
    <input type="text" name="searchKeyword" id="keywordInput"
           style="border: 0px; margin-left: 30%; margin-top: 5%"
           field="{keyword}" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”"/>
    <!--ê²€ìƒ‰ ë²„íŠ¼-->
    <button type="submit" style="border: 0; background-color: white">ğŸ”</button>
</form>

<div id="searchResult"></div>

<table id="searchResultTable" style="margin-left: 20%">
    <thead>
    <tr>
        <td>
        <th>ë‰´ìŠ¤ Message</th>
        <th>ì¶œì²˜&ì‘ì„±ì</th>
        </td>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>


<h1 style="margin-left: 25%; margin-top: 5%"> < News List > </h1>
<table style="margin-left: 20%; margin-top: 2%">
    <thead>
    <td>
    <th>ì²´í¬</th>
    <th>trueë§Œ ë…¸ì¶œ</th>
    <th>Message</th>
    <th>ì¶œì²˜&ì‘ì„±ì</th>
    </td>
    </thead>
    <tbody id="tbodyNews">
    <a href="newsRegister.html"><input type="button" value="ë‰´ìŠ¤ ë“±ë¡í•˜ê¸°"></a>
    </tbody>

    <!-- ëª¨ë‹¬ ì°½ HTML êµ¬ì¡° -->
    <div class="modal fade" id="newsUpdateModal" tabindex="-1" role="dialog" aria-labelledby="newsUpdateModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newsUpdateModalLabel">ë‰´ìŠ¤ ìˆ˜ì •</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="popupMessage">ë©”ì‹œì§€</label>
                        <input type="text" class="form-control" id="popupMessage" placeholder="ë©”ì‹œì§€">
                    </div>
                    <div class="form-group">
                        <label for="popupAuthor">ì‘ì„±ì</label>
                        <input type="text" class="form-control" id="popupAuthor" placeholder="ì‘ì„±ì">
                    </div>
                    <input type="hidden" id="popupNewsId">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">ë‹«ê¸°</button>
                    <button type="button" class="btn btn-primary" id="popupUpdateButton">ìˆ˜ì •</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ë‰´ìŠ¤ ìˆ˜ì • ë²„íŠ¼ -->
    <!--    <button type="button" class="btn btn-primary newsUpdate" value="{{news.id}}">ìˆ˜ì •</button>-->


</table>
<a href="main.html"><input type="button" value="Back"></a>
</body>
</html>