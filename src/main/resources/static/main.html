<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="./main.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <title>Title</title>
    <style>
        tr {
            border: 1px solid #444444;
        }

        th {
            border: 1px solid #444444;
        }

        td {
            border: 1px solid #444444;
        }

    </style>
    <script>
        $(document).ready(function () {
            // 1. 상위부서 리스트 조회
            $.ajax({
                type: "GET",
                contentType: "application/json; charset=utf-8",
                url: "http://localhost:8080/api/divisions/all",
                data: JSON.stringify,
                dataType: 'json',
                success: function (response) {
                    let list = response.data;
                    let htmlArr = [];
                    for (let i = 0, length = list.length; i < length; i++) {
                        let item = list[i];
                        htmlArr.push('<tr>');

                        htmlArr.push('<td class="division" data-id="' + item.id + '">' + item.division + '</td>');

                        htmlArr.push('</tr>');

                    }

                    $('#tbodyDivision').html(htmlArr.join(''));
                    console.log(response);

                },
                error: function (e) {
                    alert("Error: " + e.responseText);
                }
            });

            // 2. 상위부서 클릭 시 하위부서 리스트 조회
            $(document).on('click', '.division', function () {
                $.ajax({
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    url: "http://localhost:8080/api/divisions/" + $(this).attr('data-id'),
                    data: JSON.stringify,
                    dataType: 'json',
                    success: function (response) {
                        let list = response.data;
                        let htmlArr = [];
                        for (let i = 0, length = list.department.length; i < length; i++) {
                            let item = list.department[i];
                            htmlArr.push('<tr>');
                            htmlArr.push('<td class="department" data-id="' + item.id + '">');
                            htmlArr.push('<label for="department' + item.id + '">' + item.department + '</label>');
                            htmlArr.push('</td>');
                            htmlArr.push('</tr>');
                        }

                        $('#tbodyDepartment').html(htmlArr.join(''));
                        console.log(response);
                    },
                    error: function (e) {
                        alert("Error: " + e.responseText);
                    }
                });
            });


            // 3. 하위부서 클릭 시 직원 리스트 조회
            $(document).on('click', '.department', function () {
                let departmentId = $(this).attr('data-id');
                $('.employeeRegister').attr('data-id',departmentId);
                if (!departmentId) {
                    alert("ID is undefined.");
                    return;
                }
                $.ajax({
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    url: "http://localhost:8080/api/departments/" + departmentId,
                    dataType: 'json',
                    success: function (response) {
                        let list = response.data;
                        let htmlArr = [];
                        for (let i = 0, length = list.employee.length; i < length; i++) {
                            let item = list.employee[i];
                            let cnt = i + 1;
                            htmlArr.push('<tr>');

                            htmlArr.push('<td>');
                            htmlArr.push('<label class="Number" data-id="' + item.id + '">' + cnt + '</label><br>');
                            htmlArr.push('</td>');

                            // htmlArr.push('<td class="employee" data-id="' + item.id + '">');
                            htmlArr.push('<td>');
                            htmlArr.push('<input type="checkbox" class="choiceEmployee" id="choiceEmployee' + item.id + '" value="' + item.id + '">');
                            // htmlArr.push('<label for="employee' + item.id + '">' + item.name + '</label>');
                            htmlArr.push('</td>');

                            htmlArr.push('<td>이름');
                            htmlArr.push('<label class="employee" data-id="' + item.id + '">' + item.name + '</label><br>');
                            htmlArr.push('</td>');
                            htmlArr.push('<td>생일');
                            htmlArr.push('<label class="employee" data-id="' + item.id + '">' + item.birth + '</label><br>');
                            htmlArr.push('</td>');
                            htmlArr.push('<td>유선전화');
                            htmlArr.push('<label class="employee" data-id="' + item.id + '">' + item.extension_number + '</label><br>');
                            htmlArr.push('</td>');
                            htmlArr.push('<td>모바일');
                            htmlArr.push('<label class="employee" data-id="' + item.id + '">' + item.mobile_number + '</label><br>');
                            htmlArr.push('</td>');
                            htmlArr.push('<td>이메일');
                            htmlArr.push('<label class="employee" data-id="' + item.id + '">' + item.email + '</label><br>');
                            htmlArr.push('</td>');

                            htmlArr.push('<td>');
                            htmlArr.push('<button type="button" class="employeeUpdate" id="employeeUpdate' + item.id + '" value="' + item.id + '">수정<br>');
                            htmlArr.push('</td>');

                            htmlArr.push('<td>');
                            htmlArr.push('<button type="button" class="employeeDelete" id="employeeDelete' + item.id + '" value="' + item.id + '">삭제<br>');
                            htmlArr.push('</td>');

                            htmlArr.push('</tr>');
                        }

                        $('#tbodyEmployee').html(htmlArr.join(''));
                        console.log(response);
                    },
                    error: function (e) {
                        alert("Error: " + e.responseText);
                    }

                });


                // 직원 등록
                $(document).ready(function () {
                    $(document).on('click', '.employeeRegister', function () {
                        let departmentId = $(this).attr('data-id');
                        if (!departmentId) {
                            alert("ID is undefined.");
                            return;
                        }
                        // Reset the form fields
                        $("#popupName1").val("");
                        $("#popupBirth1").val("");
                        $("#popupExtension_number1").val("");
                        $("#popupMobile_number1").val("");
                        $("#popupEmail1").val("");
                        // 숨겨진 입력 필드에 부서 ID 설정
                        $("#popupDepartmentId").val(departmentId);
                        // modal 창 열기
                        $("#employeeRegisterModal").modal("show");
                    });

                    $("#popupRegisterButton").on('click', function () {

                        let data = {
                            name: $("#popupName1").val(),
                            birth: $("#popupBirth1").val(),
                            extension_number: $("#popupExtension_number1").val(),
                            mobile_number: $("#popupMobile_number1").val(),
                            email: $("#popupEmail1").val(),
                        };
                        $.ajax({
                            type: "POST",
                            contentType: "application/json; charset=utf-8",
                            url: "http://localhost:8080/api/employees/create/" + departmentId,
                            data: JSON.stringify(data),
                            dataType: 'json',
                            success: function (response) {
                                if (null !== response) {
                                    console.log(response);
                                    alert('등록이 완료되었습니다.');
                                    // Close the register employee modal
                                    $("#employeeRegisterModal").modal("hide");
                                    // Refresh the page
                                    location.reload();
                                } else {
                                    alert('등록 실패');
                                }
                            },
                            error: function (e) {
                                alert("Error: " + e.responseText);
                            }
                        });
                    });

                });


                // 체크하면 리더 지정
                $(document).on('click', '.choiceEmployee', function () {
                    let employeeId = $(this).val();
                    if (!employeeId) {
                        alert("ID is undefined.");
                        return;
                    }
                    $.ajax({
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        url: "http://localhost:8080/api/employees/choice/" + employeeId,
                        dataType: 'json',
                        success: function (response) {
                            if (response.success === true) {
                                console.log(response);
                            }
                        },
                        error: function (e) {
                            alert("Error: " + e.responseText);
                        }
                    });
                });
                // }).prop('checked', function () {
                // return this.getAttribute('checked') !== null;
                // });



                $(document).ready(function () {
                    // employeeUpdate 버튼 클릭 시 팝업창 띄우기
                    $(document).on('click', '.employeeUpdate', function () {
                        let employeeId = $(this).val();
                        // let employeeId = $(this).attr('data-id');
                        if (!employeeId) {
                            alert("ID is undefined.");
                            return;
                        }
                        // 직원 정보를 가져와서 팝업창에 노출
                        $.ajax({
                            type: "GET",
                            contentType: "application/json; charset=utf-8",
                            url: "http://localhost:8080/api/employees/" + employeeId,
                            dataType: 'json',
                            // success: function (data) {
                            //     let employee = data;
                            success: function (response) {
                                if (response.success === true) {
                                    console.log(response);
                                    let employee = response.data;
                                    // 팝업창에 직원 정보 채우기
                                    $("#popupName").val(employee.name);
                                    $("#popupBirth").val(employee.birth);
                                    $("#popupExtension_number").val(employee.extension_number);
                                    $("#popupMobile_number").val(employee.mobile_number);
                                    $("#popupEmail").val(employee.email);
                                    // 직원 수정 버튼에 employeeId 저장
                                    $("#popupEmployeeId").val(employeeId);
                                    // 팝업창 열기
                                    $("#employeeUpdateModal").modal("show");
                                }
                            },
                            error: function (e) {
                                alert("Error: " + e.responseText);
                            }
                        });
                    });

                    // 직원 수정
                    $("#popupUpdateButton").on('click', function () {
                        let employeeId = $("#popupEmployeeId").val();
                        if (!employeeId) {
                            alert("ID is undefined.");
                            return;
                        }
                        let data = {
                            name: $("#popupName").val(),
                            birth: $("#popupBirth").val(),
                            extension_number: $("#popupExtension_number").val(),
                            mobile_number: $("#popupMobile_number").val(),
                            email: $("#popupEmail").val(),
                        };
                        $.ajax({
                            type: "PUT",
                            contentType: "application/json; charset=utf-8",
                            url: "http://localhost:8080/api/employees/update/" + employeeId,
                            data: JSON.stringify(data),
                            dataType: 'json',
                            success: function (response) {
                                if (null !== response) {
                                    console.log(response);
                                    alert('수정이 완료되었습니다.');
                                    // 팝업창 닫기
                                    $("#employeeUpdateModal").modal("hide");
                                    // 화면 새로고침
                                    location.reload();
                                } else {
                                    alert('실패');
                                }
                            },
                            error: function (e) {
                                alert("Error: " + e.responseText);
                            }
                        });
                    });
                });

                // 직원 삭제
                $(document).on('click', '.employeeDelete', function () {
                    let employeeId = $(this).val();
                    if (!employeeId) {
                        alert("ID is undefined.");
                        return;
                    }
                    $.ajax({
                        type: "DELETE",
                        contentType: "application/json; charset=utf-8",
                        url: "http://localhost:8080/api/employees/delete/" + employeeId,
                        dataType: 'json',
                        success: function (response) {
                            if (null !== response) {
                                console.log(response);
                                alert('삭제되었습니다.');
                                location.reload();
                            } else {
                                alert('삭제 실패');
                            }
                        },
                        error: function (e) {
                            alert("Error: " + e.responseText);
                        }
                    });
                });
            });


            // 5. 리더 리스트 불러오기

        });


        // 회원 탈퇴
        $(document).ready(function () {

            $("#deleteAdminForm").submit(function (event) {
                event.preventDefault(); // 폼 전송 방지
                // 관리자 ID 조회
                let adminId = localStorage.getItem('adminId'); // 로컬 스토리지에서 adminId 가져오기
                if (!adminId) {
                    alert("ID is undefined.");
                    return;
                }
                $.ajax({
                    type: "DELETE",
                    contentType: "application/json; charset=utf-8",
                    // url: "http://localhost:8080/api/admins/delete/" + $(this).attr('data-id'),
                    url: "http://localhost:8080/api/admins/delete/" + adminId,
                    // data: JSON.stringify({adminId: adminId}),
                    data: JSON.stringify,
                    dataType: 'json',
                    // beforeSend: function(xhr) { // 헤더에 토큰 추가
                    //     xhr.setRequestHeader("Refresh_Token", token);
                    // },
                    success: function(response) {
                        if (response.success === true) {
                            alert("회원탈퇴가 완료되었습니다.");
                            window.location.href = 'http://localhost:8080/login.html';
                        } else {
                            alert('다시 시도해주세요.')
                        }
                    },
                    error: function (e) {
                        alert("Error: " + e.responseText);
                    }
                });
            });
        });

        // 로그아웃
        $(document).ready(function () {

            $("#logoutForm").submit(function (event) {
                event.preventDefault(); // 폼 전송 방지
                // 관리자 ID 조회
                localStorage.removeItem('adminId'); // 로컬 스토리지에서 adminId 가져오기
                window.location.href = 'http://localhost:8080/login.html';
            });
        });


    </script>
</head>
<body>
<p>메인 화면</p>
<!-- header -->
<div class="main-image">
<form id="deleteAdminForm" action="">
<!--    <button id="btn-save" class="deleteAdmin" id="deleteAdmin" >회원탈퇴</button>-->
    <button class="deleteAdmin" id="deleteAdmin">회원탈퇴</button>
</form>
<form id="logoutForm">
<!--    <button id="btn-save1" class="logoutAdmin" id="logoutAdmin" >로그아웃</button>-->
    <button class="logout" id="logout">로그아웃</button>
</form>
<!--    메인 이미지-->
</div>

<!-- content -->
<div class="content-title"><h2>Department</h2></div>

<table>
    <tr>
        <td>
            <table>
                <thead>
                <tr>
                    <th>상위부서</th>
                </tr>
                </thead>
                <tbody id="tbodyDivision">
                </tbody>
            </table>
        </td>
        <td>
            <table>
                <thead>
                <tr>
                    <th>하위부서</th>
                </tr>
                </thead>
                <tbody id="tbodyDepartment">
                </tbody>
            </table>
        </td>
        <td>
            <table>
                <thead>
                <tr>
                    <th>직원</th>
                </tr>
                </thead>
                <tbody id="tbodyEmployee">
                </tbody>
                <tbody id="tbodyEmployeeRegister">
                <input type="button" class="employeeRegister" id="employeeRegister" value="직원 등록">
                </tbody>
                </td>
<!--                <td>-->
<!--                    <table>-->
<!--                        <thead>-->
<!--                        <tr>-->
<!--                            <th>리더목록</th>-->
<!--                        </tr>-->
<!--                        </thead>-->
<!--                        <tbody id="tbodyLeader">-->
<!--                        </tbody>-->
<!--                    </table>-->
<!--                </td>-->
            </table>

            <!-- 모달 창 HTML 구조 -->
            <div class="modal fade" id="employeeUpdateModal" tabindex="-1" role="dialog"
                 aria-labelledby="employeeUpdateModalLabel"
                 aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="employeeUpdateModalLabel">직원 수정</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="popupName">이름</label>
                                <input type="text" class="form-control" id="popupName" placeholder="ex) 홍길동">
                            </div>
                            <div class="form-group">
                                <label for="popupBirth">생일</label>
                                <input type="text" class="form-control" id="popupBirth" placeholder="ex) 0304">
                            </div>
                            <div class="form-group">
                                <label for="popupExtension_number">유선 전화 번호</label>
                                <input type="text" class="form-control" id="popupExtension_number" placeholder="ex) 07022223333">
                            </div>
                            <div class="form-group">
                                <label for="popupMobile_number">모바일 번호</label>
                                <input type="text" class="form-control" id="popupMobile_number" placeholder="ex) 01022223333">
                            </div>
                            <div class="form-group">
                                <label for="popupEmail">이메일</label>
                                <input type="text" class="form-control" id="popupEmail" placeholder="ex) gildong@everybot.net">
                            </div>
                            <input type="hidden" id="popupEmployeeId">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                            <button type="button" class="btn btn-primary" id="popupUpdateButton">수정</button>
                        </div>
                    </div>
                </div>
            </div>


            <!--직원 등록 modal-->
            <div class="modal fade" id="employeeRegisterModal" tabindex="-1" role="dialog"
                 aria-labelledby="employeeRegisterModalLabel"
                 aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="employeeRegisterModalLabel">직원 등록</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="popupName">이름</label>
                                <input type="text" class="form-control" id="popupName1" placeholder="ex) 홍길동">
                            </div>
                            <div class="form-group">
                                <label for="popupBirth">생일</label>
                                <input type="text" class="form-control" id="popupBirth1" placeholder="ex) 0304">
                            </div>
                            <div class="form-group">
                                <label for="popupExtension_number">유선전화번호</label>
                                <input type="text" class="form-control" id="popupExtension_number1" placeholder="ex) 07022223333">
                            </div>
                            <div class="form-group">
                                <label for="popupMobile_number">모바일번호</label>
                                <input type="text" class="form-control" id="popupMobile_number1" placeholder="ex) 01022223333">
                            </div>
                            <div class="form-group">
                                <label for="popupEmail">이메일</label>
                                <input type="text" class="form-control" id="popupEmail1" placeholder="ex) gildong@everybot.net">
                            </div>
                            <input type="hidden" id="popupEmployeeId1">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                            <button type="button" class="btn btn-primary" id="popupRegisterButton">등록</button>
                        </div>
                    </div>
                </div>
            </div>

</table>

<table>
    <td>
        <thead>
        <tr>
<!--            <th>전체 직원 목록</th>-->
            < 전체 직원 목록 >
        </tr>
        </thead>
        <tbody id="tbodyAllEmployee">
        </tbody>
    </td>
</table>

<form>

<!--    <div class="goto-news">-->
<!--        <button class="goto-news-botton" onclick="location.href='newsList.html'"><h4>뉴스페이지 바로가기</h4></button>-->
<!--    </div>-->

    <div class="goto-news">
    <a href="newsList.html"><input type="button" class="goto-news-botton" value="뉴스페이지"></a>
    </div>
</form>

</body>
</html>