<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!--    <link rel="stylesheet" href="./main.css">-->
    <link rel="stylesheet" type="text/css" href="../css/common.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>

    <title>직원 전체목록</title>
    <style>
        .wrap {
            width: 80%;
            margin: 3% auto;
        }
        .search-box {
            margin-bottom: 5%;
        }
    </style>

    <script>
        $(document).ready(function () {
            // 로컬 스토리지에서 정보 가져오기
            var emailId = localStorage.getItem("emailId");
            // A 태그에 정보 표시
            $("#myEmailId").text(emailId);

            // 전체 직원 조회
            $.ajax({
                type: "GET",
                contentType: "application/json; charset=utf-8",
                url: "http://43.201.241.17:8080/api/employees/all",
                data: JSON.stringify,
                dataType: 'json',
                headers: {
                    "Authorization": localStorage.getItem("accessToken")
                },
                success: function (response) {
                    let list = response.member;
                    let htmlArr = [];
                    for (let i = 0, length = list.length; i < length; i++) {
                        let item = list[i];
                        let cnt = i + 1;
                        htmlArr.push('<tr>');

                        htmlArr.push('<td>');
                        htmlArr.push('<label class="Number" data-id="' + item.id + '">' + cnt + '</label><br>');
                        htmlArr.push('</td>');

                        htmlArr.push('<td>');
                        htmlArr.push('<label class="employee" data-id="' + item.id + '">' + item.name + '</label><br>');
                        htmlArr.push('</td>');

                        htmlArr.push('<td>');
                        htmlArr.push('<label class="employee" data-id="' + item.id + '">' + item.division + '</label><br>');
                        htmlArr.push('</td>');

                        htmlArr.push('<td>');
                        htmlArr.push('<label class="employee" data-id="' + item.id + '">' + item.department + '</label><br>');
                        htmlArr.push('</td>');

                        htmlArr.push('<td>');
                        htmlArr.push('<label class="employee" data-id="' + item.id + '">' + item.birth + '</label><br>');
                        htmlArr.push('</td>');
                        htmlArr.push('<td>');
                        htmlArr.push('<label class="employee" data-id="' + item.id + '">' + item.extension_number + '</label><br>');
                        htmlArr.push('</td>');
                        htmlArr.push('<td>');
                        htmlArr.push('<label class="employee" data-id="' + item.id + '">' + item.mobile_number + '</label><br>');
                        htmlArr.push('</td>');
                        htmlArr.push('<td>');
                        htmlArr.push('<label class="employee" data-id="' + item.id + '">' + item.email + '</label><br>');
                        htmlArr.push('</td>');

                        htmlArr.push('</tr>');
                    }

                    $('#tbodyEmployeeAll').html(htmlArr.join(''));
                    console.log(response);

                },
                error: function (e) {
                    alert("Error: " + e.responseText);
                }
            });

            // 직원 검색
            $(document).ready(function () {
                $("#searchResultTable").hide();

                $("#searchEmpForm").submit(function (event) {
                    event.preventDefault(); // 폼 전송 방지

                    let keyword = $("#keywordInput").val(); // 검색어 가져오기
                    // var keyword = $("#searchKeyword").val(); // 검색어 가져오기

                    if (keyword.trim() === '') { // 검색어가 비어있는 경우
                        alert('검색어를 입력해주세요.');
                        return; // 함수 종료
                    }

                    $.ajax({
                        type: "GET",
                        contentType: "application/json; charset=utf-8",
                        url: "http://43.201.241.17:8080/api/employees/search?keyword=" + keyword,
                        data: JSON.stringify,
                        // data: { keyword: keyword }, // 검색어를 URL parameter로 전달
                        dataType: 'json',
                        success: function (response) {
                            if (response.success === true) {
                                // 검색 결과를 출력하는 부분
                                let searchResultTableBody = $("#searchResultTable tbody");
                                searchResultTableBody.empty(); // 기존 검색 결과 삭제

                                if (response.data.length > 0) {
                                    for (let i = 0; i < response.data.length; i++) {
                                        let emp = response.data[i];
                                        let row = $("<tr></tr>");

                                        row.append($("<td></td>").text(i + 1));
                                        row.append($("<td></td>").text(emp.name));
                                        row.append($("<td></td>").text(emp.division));
                                        row.append($("<td></td>").text(emp.department));
                                        row.append($("<td></td>").text(emp.birth));
                                        row.append($("<td></td>").text(emp.extension_number));
                                        row.append($("<td></td>").text(emp.mobile_number));
                                        row.append($("<td></td>").text(emp.email));

                                        searchResultTableBody.append(row);
                                    }
                                    // 검색결과를 보이기
                                    $("#searchResultTable").show();
                                } else {
                                    alert('검색 결과가 없습니다.');
                                }
                            } else {
                                alert('다시 시도해주세요.')
                            }
                        },
                        error: function (e) {
                            alert("Error: " + e.responseText);
                        }
                    });
                });
            });
        });


    </script>

</head>
<body>
<!-- 상단 navbar -->
<div class="nav-box">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Everybot</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <!--                    <li class="nav-item">-->
                    <!--                        <a class="nav-link active" aria-current="page" href="#">Home</a>-->
                    <!--                    </li>-->
                    <li class="nav-item">
                        <a class="nav-link" href="main.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="empList.html">직원 전체목록</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="newsList.html">뉴스 페이지</a>
                    </li>
                </ul>
                <form class="d-flex" style="margin-right: 10px">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                               data-bs-toggle="dropdown" aria-expanded="false">
                                <span id="myEmailId"></span>
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                <li><a class="dropdown-item" id="logoutAdmin">로그아웃</a></li>
                                <li><a class="dropdown-item" id="deleteAdmin">회원 탈퇴</a></li>
                            </ul>
                        </li>
                    </ul>
                </form>
            </div>
        </div>
    </nav>
</div>
<div class="wrap">
    <div class="search-box">
        <form id="searchEmpForm" class="form-inline my-2 my-lg-0" style="margin-right: 20%">
            <div class="row">
                <div class="col-10">
                    <input id="keywordInput" field="{keyword}" class="form-control mr-sm-2" type="search"
                           placeholder="검색어를 입력하세요" aria-label="Search">
                </div>
                <div class="col-2">
                    <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
                </div>
            </div>
        </form>
    </div>
    <div style="width: 1000px; align-content: center">
        <!--직원 검색 목록-->
        <table id="searchResultTable" class="table">
            <thead class="thead-dark">
            <tr>
                <th>NO</th>
                <th>이름</th>
                <th>상위부서</th>
                <th>하위부서</th>
                <th>생일</th>
                <th>유선전화번호</th>
                <th>모바일번호</th>
                <th>이메일</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>

        <!--직원 전체 목록-->
        <table class="table">
            <thead class="thead-dark">
            <tr>
                <th>NO</th>
                <th>이름</th>
                <th>상위부서</th>
                <th>하위부서</th>
                <th>생일</th>
                <th>유선전화번호</th>
                <th>모바일번호</th>
                <th>이메일</th>
            </tr>
            </thead>
            <tbody id="tbodyEmployeeAll">
            </tbody>
        </table>
        <div id="searchResult"></div>

    </div>
</div>

<!--<form id="searchEmpForm" action="">-->
<!--    <input type="text" name="searchKeyword" id="keywordInput"-->
<!--           style="border: 0px; margin-left: 30%; margin-top: 5%"-->
<!--           field="{keyword}" placeholder="검색어를 입력하세요"/>-->

<!--    &lt;!&ndash;검색 버튼&ndash;&gt;-->
<!--    <button type="submit" style="border: 0; background-color: white">🔍</button>-->
<!--</form>-->

<!--<div id="searchResult"></div>-->

<!--<table id="searchResultTable" style="margin-left: 25%">-->
<!--    <thead>-->
<!--    <tr>-->
<!--        <td>-->
<!--        <th>이름</th>-->
<!--        <th>상위부서</th>-->
<!--        <th>하위부서</th>-->
<!--        <th>생일</th>-->
<!--        <th>유선전화번호</th>-->
<!--        <th>모바일번호</th>-->
<!--        <th>이메일</th>-->
<!--        </td>-->
<!--    </tr>-->
<!--    </thead>-->
<!--    <tbody>-->
<!--    </tbody>-->
<!--</table>-->


<!--<h1 style="margin-left: 25%; margin-top: 5%"> < 직원 전체 목록 > </h1>-->
<!--<table style="margin-left: 20%; margin-top: 2%">-->

<!--    <thead>-->
<!--    <td>-->
<!--    <th>이름</th>-->
<!--    <th>상위부서</th>-->
<!--    <th>하위부서</th>-->
<!--    <th>생일</th>-->
<!--    <th>유선전화번호</th>-->
<!--    <th>모바일번호</th>-->
<!--    <th>이메일</th>-->
<!--    </td>-->
<!--    </thead>-->
<!--    <tbody id="tbodyEmployeeAll">-->
<!--    </tbody>-->
<!--</table>-->
<!--<a href="main.html"><input type="button" value="Back"></a>-->


</body>
</html>